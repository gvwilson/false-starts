<!DOCTYPE html>
<html lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Nitinat</title>
    <link rel="stylesheet" href="theme/nitinat.css">
    <link rel="stylesheet" href="theme/tango.css">
  </head>
  <body>
    <div class="row">
      <div class="column smaller">
        <h2><a href="index.html">Nitinat</a></h2>
        <p>
          A model data analysis project in Python
        </p>
	<ol type="1">
  
  <li>
    <a href="starting.html">
      
        Starting
      
    </a>
  </li>
  
  <li>
    <a href="project.html">
      
        Setting Up a Python Project
      
    </a>
  </li>
  
  <li>
    <a href="dataset.html">
      
        Handling Data
      
    </a>
  </li>
  
  <li>
    <a href="reproducible.html">
      
        Making Tasks Reproducible
      
    </a>
  </li>
  
  <li>
    <a href="results.html">
      
        Producing Results
      
    </a>
  </li>
  
  <li>
    <a href="quality.html">
      
        Checking Code Quality
      
    </a>
  </li>
  
  <li>
    <a href="setback-01.html">
      
        The First Setback
      
    </a>
  </li>
  
  <li>
    <a href="configuration.html">
      
        Consistent Configuration
      
    </a>
  </li>
  
  <li>
    <a href="testing.html">
      
        Improving Testing
      
    </a>
  </li>
  
  <li>
    <a href="logging.html">
      
        Logging
      
    </a>
  </li>
  
  <li>
    <a href="technical-debt-01.html">
      
        Technical Debt
      
    </a>
  </li>
  
  <li>
    <a href="parameters.html">
      
        Handling Model Parameters
      
    </a>
  </li>
  
  <li>
    <a href="pipeline-01.html">
      
        Creating a Pipeline
      
    </a>
  </li>
  
  <li>
    <a href="technical-debt-02.html">
      
        Technical Debt Revisited
      
    </a>
  </li>
  
  <li>
    <a href="pipeline-02.html">
      
        Pipeline Revisited
      
    </a>
  </li>
  
  <li>
    <a href="website-01.html">
      
        Creating a Website
      
    </a>
  </li>
  
  <li>
    <a href="pipeline-03.html">
      
        A Pipeline with Provenance
      
    </a>
  </li>
  
  <li>
    <a href="website-02.html">
      
        Improving the Website
      
    </a>
  </li>
  
  <li>
    <a href="documentation.html">
      
        Documenting Code
      
    </a>
  </li>
  
  <li>
    <a href="packaging.html">
      
        Creating a Package
      
    </a>
  </li>
  
  <li>
    <a href="ci.html">
      <strong>
        Continuous Integration
      </strong>
    </a>
  </li>
  
  <li>
    <a href="indexing.html">
      
        Indexing Datasets
      
    </a>
  </li>
  
  <li>
    <a href="dependencies.html">
      
        Handling Task Dependencies
      
    </a>
  </li>
  
  <li>
    <a href="layered.html">
      
        Layered Configuration
      
    </a>
  </li>
  
  <li>
    <a href="database.html">
      
        Accessing a Database
      
    </a>
  </li>
  
</ol>
<ol type="A">
  
  <li>
    <a href="data.html">
      
        Parameter Sets
      
    </a>
  </li>
  
  <li>
    <a href="license.html">
      
        License
      
    </a>
  </li>
  
  <li>
    <a href="links.html">
      
        Links
      
    </a>
  </li>
  
  <li>
    <a href="credits.html">
      
        Credits
      
    </a>
  </li>
  
</ol>

	<ul>
	  <li><a href="nitinat/index.html">Documentation</a></li>
	  <li><a href="https://github.com/gvwilson/nitinat/">Source</a></li>
	</ul>
      </div>
      <div class="column bordered">
        <h1>Continuous Integration</h1>
        <ul>
<li>Should always run checks when committing code<ul>
<li>Or changing documentation, or...</li>
</ul>
</li>
<li>But human beings are fallible, so automate: continuous integration (CI)</li>
<li>Many dedicated CI services like <a href="https://circleci.com/">Circle CI</a></li>
<li>For a project this size, easiest is <a href="https://docs.github.com/en/actions">GitHub Actions</a></li>
<li>Create a directory <code>.github/workflows</code> beneath the root of the project</li>
<li>Add a file <code>test-on-push.yml</code> in that directory:</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Test on Push</span>
<span class="nt">on</span><span class="p">:</span>
  <span class="nt">push</span><span class="p">:</span>
    <span class="nt">branches</span><span class="p">:</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">main</span>
  <span class="nt">pull_request</span><span class="p">:</span>
    <span class="nt">branches</span><span class="p">:</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">main</span>
<span class="nt">jobs</span><span class="p">:</span>
  <span class="nt">build</span><span class="p">:</span>
    <span class="nt">runs-on</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">ubuntu-latest</span>
    <span class="nt">steps</span><span class="p">:</span>
      <span class="p p-Indicator">-</span> <span class="nt">uses</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">actions/checkout@v2</span>
      <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Set up Python</span>
        <span class="nt">uses</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">actions/setup-python@v1</span>
        <span class="nt">with</span><span class="p">:</span>
          <span class="nt">python-version</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">3.9</span>
      <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Install dependencies</span>
        <span class="nt">run</span><span class="p">:</span> <span class="p p-Indicator">|</span>
          <span class="no">python -m pip install --upgrade pip</span>
          <span class="no">pip install -r requirements.txt</span>
      <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Run code checks</span>
        <span class="nt">run</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">inv lint</span>
      <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Run tests</span>
        <span class="nt">run</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">inv test</span>
        <span class="nt">if</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">${{ always() }}</span>
</code></pre></div>
<ul>
<li><code>name</code> is the name of the action (used in error reporting, etc.)</li>
<li><code>on</code> defines when the action runs<ul>
<li>When there's a <code>push</code> to the <code>main</code> branch</li>
<li>When anyone creates a pull request whose target is <code>main</code></li>
<li>Lots of other options</li>
</ul>
</li>
<li><code>jobs</code> defines what to do when the action runs<ul>
<li>An action can run many jobs in parallel</li>
</ul>
</li>
<li>We want to build our software on the latest version of Ubuntu Linux<ul>
<li>Probably the most common platform</li>
</ul>
</li>
<li>Spell out the steps:<ul>
<li>Use a <a href="https://github.com/actions">pre-defined <code>checkout</code> action</a> to get a fresh copy of the repo</li>
<li>Set up Python using another pre-defined action</li>
<li>Install everything listed in <code>requirements.txt</code></li>
<li>Run the code checks (do <em>not</em> reformat, just check)</li>
<li>Run the tests: the <code>if</code> condition means "even if the previous linting step fails"</li>
</ul>
</li>
<li>Before we test it, let's split requirements into "needed for install" and "also used in dev"</li>
<li><code>requirements.txt</code> becomes:</li>
</ul>
<div class="highlight"><pre><span></span><code>kaleido&gt;=0.2
pandas&gt;=1.4
plotly&gt;=5.6
pydantic&gt;=1.9.0
pyyaml&gt;=5.4
requests&gt;=2.27
statsmodels&gt;=0.13
</code></pre></div>
<ul>
<li>Create a new file <code>development.txt</code> that tells <code>pip</code> to read <code>requirements.txt</code> (using <code>-r</code>) then add more packages</li>
</ul>
<div class="highlight"><pre><span></span><code>-r requirements.txt
black&gt;=22.1
coverage&gt;=6.3
flake8&gt;=4.0
invoke&gt;=1.7
isort&gt;=5.10
ivy&gt;=6.2
pdoc3&gt;=0.10
pymdown-extensions&gt;=9.3
pyproject-flake8
pytest&gt;=7.1
</code></pre></div>
<ul>
<li><code>git add</code> changes, commit, push to GitHub, go to the <code>Actions</code> tab: the job has failed<ul>
<li>Because <code>invoke</code> isn't included in <code>requirements.txt</code>, but is needed for the action</li>
<li>So are <code>black</code>, <code>flake8</code>, <code>isort</code>, and <code>pytest</code></li>
</ul>
</li>
<li>Move <code>invoke</code> to <code>requirements.txt</code>, add, commit, push<ul>
<li>Works this time</li>
<li>Some projects have <code>development.txt</code>, <code>testing.txt</code>, and <code>requirements.txt</code> for this reason</li>
<li>It all should live in <code>pyproject.toml</code>...</li>
</ul>
</li>
</ul>
<div class="callout">
<h3>Other Jobs</h3>
<p>The GitHub Actions tab shows all the jobs, including the ones that build and deploy the website.
If you have pushed several times, then rebase and push the combined commit,
the jobs run by the now-squashed commits still show up.</p>
</div>
      </div>
    </div>
  </body>
</html>
