<!DOCTYPE html>
<html lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Mesachie</title>
    <link rel="stylesheet" href="../mccole.css">
    <link rel="stylesheet" href="../tango.css">
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        TeX: { equationNumbers: { autoNumber: "AMS" } }
      })
    </script>
    <script type="text/javascript" async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
  </head>
  <body>
    <div class="row">
      <div class="column">
        <h2><a href="../">Mesachie</a></h2>
        <p>
          A compassionate, evidence-based introduction
        </p>
	<ol type="1">
  
  <li>
    <a href="../intro/">
      
        Introduction
      
    </a>
  </li>
  
  <li>
    <a href="../project/">
      <strong>
        A Minimum Viable Project
      </strong>
    </a>
  </li>
  
  <li>
    <a href="../team/">
      
        A Minimum Viable Team
      
    </a>
  </li>
  
  <li>
    <a href="../dstools/">
      
        Data Science Tools
      
    </a>
  </li>
  
</ol>
<ol type="A">
  
  <li>
    <a href="../license/">
      
        License
      
    </a>
  </li>
  
  <li>
    <a href="../conduct/">
      
        Code of Conduct
      
    </a>
  </li>
  
  <li>
    <a href="../reviewers/">
      
        Reviewers
      
    </a>
  </li>
  
  <li>
    <a href="../bib/">
      
        Bibliography
      
    </a>
  </li>
  
  <li>
    <a href="../links/">
      
        Links
      
    </a>
  </li>
  
  <li>
    <a href="../gloss/">
      
        Glossary
      
    </a>
  </li>
  
</ol>

      </div>
      <div class="column bordered">
        <h1>A Minimum Viable Project</h1>
        <ul>
<li>Some things are the same for every project [<a href="../bib/#Fogel2005,">Fogel2005,</a>, <a href="../bib/#Fogel2020">Fogel2020</a>]</li>
<li>Show the Python version with some notes about JavaScript</li>
</ul>
<h2>Create repository on GitHub</h2>
<ul>
<li>Do this under a personal account, but for a real project would do it under an organizational account</li>
<li>Chose a name that wasn't already taken on <a href="https://pypi.org/">PyPI</a><ul>
<li>Because we want to create a package in future</li>
<li>All the good names are taken, so I chose the name of a small town near where I grew up</li>
</ul>
</li>
<li>Made it public</li>
<li>Added the following:<ul>
<li><code>README.md</code> (this file) is normally a description of the project, but we'll use it for note-taking</li>
<li><code>.gitignore</code> (selected from pulldown) to tell Git not to track ephemeral files generated by Python projects</li>
<li><a href="https://choosealicense.com/licenses/mit/">MIT license</a> (which GitHub puts in <code>LICENSE</code> rather than <code>LICENSE.md</code> - rename it)</li>
</ul>
</li>
</ul>
<h2>Add the files every project should have</h2>
<ul>
<li>Write these notes</li>
<li>Rename <code>LICENSE</code> to <code>LICENSE.md</code> (because file extensions are good)</li>
<li>Add <code>*~</code> to the <code>.gitignore</code> (for Emacs users)</li>
<li>Commit changes with a message that follows <a href="https://www.conventionalcommits.org/">conventional commits</a>:</li>
</ul>
<div class="highlight"><pre><span></span><code>feat: describing steps so far and cleaning up default files

-   Rename `LICENSE` to show it&#39;s a Markdown file
-   Add notes to `README.md` about steps so far
-   Add Emacs backup files to `.gitignore
</code></pre></div>
<ul>
<li>The subject line describes what kind of change it is (adding a feature)<ul>
<li>The body itemizes the changes</li>
</ul>
</li>
<li>Push to GitHub</li>
</ul>
<h2>Add Code of Conduct and contributors' guide</h2>
<ul>
<li>Used to add CoC by copying in a Markdown file, but <a href="https://docs.github.com/en/communities/setting-up-your-project-for-healthy-contributions/adding-a-code-of-conduct-to-your-project">GitHub now supports this directly</a><ul>
<li>Note: use <code>[text][key]</code> links in the body of my Markdown files and <code>[key]: url</code> in the foot</li>
</ul>
</li>
<li>Follow GitHub's instructions to add CoC<ul>
<li>Call the branch <code>feat/code-of-conduct</code> (colons don't play nicely in Git branch names)</li>
</ul>
</li>
<li>Copy in <code>CONTRIBUTING.md</code> from an existing project and edit<ul>
<li>Rename/add tags in GitHub to match descriptions in <code>CONTRIBUTING.md</code> (because GitHub's defaults aren't sensible)</li>
</ul>
</li>
<li><em>Don't</em> add a <code>GOVERNANCE.md</code> file explaining how decisions are made and who gets to make them<ul>
<li>But will as soon as the project attracts other people</li>
</ul>
</li>
<li>Note: if you and your team are creating a lot of projects, consider using <a href="https://cookiecutter.readthedocs.io/">Cookiecutter</a> to keep them consistent</li>
</ul>
<h2>Set up Python package</h2>
<ul>
<li>Create <code>mesachie</code> directory to contain package code<ul>
<li>Standard Python package structure to keep package code separate from support code</li>
</ul>
</li>
<li>Add <code>mesachie/__init__.py</code>:</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="sd">&quot;&quot;&quot;Mesachie: a data analysis software project in Python.&quot;&quot;&quot;</span>

<span class="n">__version__</span> <span class="o">=</span> <span class="s2">&quot;0.1.0&quot;</span>
<span class="n">__author__</span> <span class="o">=</span> <span class="s2">&quot;Greg Wilson&quot;</span>
</code></pre></div>
<ul>
<li>The existence of <code>__init__.py</code> signals that this directory is an importable module
        -   It can even be empty<ul>
<li>First line is a documentation string (docstring) explaining the file's purpose</li>
<li>The <code>__version__</code> and <code>__author__</code> variables are recognized by Python's packaging tools</li>
</ul>
</li>
<li>Create <code>tests</code> directory <em>beside</em> the <code>mesachie</code> package directory to contain tests<ul>
<li>And create <code>tests/__init__.py</code> to keep testing tools happy</li>
</ul>
</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="sd">&quot;&quot;&quot;Make tests look like a module so actual module will load.&quot;&quot;&quot;</span>
</code></pre></div>
<ul>
<li>Create a <a href="https://docs.conda.io/">conda</a> virtual environment to avoid conflicts between packages installed for different projects<ul>
<li>Note: some people prefer <a href="https://www.docker.com/">Docker</a> for isolating environments...</li>
<li>...and because it's what we'll eventually use when we run in the cloud</li>
</ul>
</li>
</ul>
<div class="highlight"><pre><span></span><code>$ conda create -n mesachie <span class="nv">python</span><span class="o">=</span><span class="m">3</span>.9
<span class="c1"># say &#39;y&#39; to the prompt</span>
$ conda activate mesachie
</code></pre></div>
<ul>
<li>Install <a href="http://pytest.org/">pytest</a> to run tests:<ul>
<li>Can (should) use <code>conda install</code> instead, but <code>pip</code> is simpler for small projects</li>
</ul>
</li>
</ul>
<div class="highlight"><pre><span></span><code>$ pip install pytest
</code></pre></div>
<ul>
<li>Create <code>requirements.txt</code> to make package installation reproducible<ul>
<li>What version did we get?</li>
</ul>
</li>
</ul>
<div class="highlight"><pre><span></span><code>$ conda list pytest
<span class="c1">#&gt; pytest        7.1.1</span>
</code></pre></div>
<ul>
<li>Name uses three-part <a href="https://semver.org/">semantic versioning</a> to identify major version, minor version, and patch</li>
<li>Create <code>requirements.txt</code> file with major and minor version</li>
</ul>
<div class="highlight"><pre><span></span><code>pytest&gt;=7.1
</code></pre></div>
<ul>
<li>Create a "heartbeat" test in <code>tests/test_heartbeat.py</code> to make sure we can load our module</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="sd">&quot;&quot;&quot;Check that the project has a heartbeat.&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">mesachie</span>


<span class="k">def</span> <span class="nf">test_module_can_be_imported</span><span class="p">():</span>
    <span class="k">pass</span>
</code></pre></div>
<ul>
<li>Names of test files and functions must started with <code>test_</code> so that <code>pytest</code> can find them<ul>
<li>Don't use docstrings for tests: give them long informative names</li>
<li>This test doesn't check anything (<code>pass</code>), but <code>pytest</code> will complain if <code>mesachie</code> cannot be imported</li>
</ul>
</li>
<li>Run the test:</li>
</ul>
<div class="highlight"><pre><span></span><code>$ pytest
<span class="c1">#&gt; collected 1 item</span>
<span class="c1">#&gt; tests/test_heartbeat.py .  </span>
</code></pre></div>
<ul>
<li>Add to these notes, commit, and push</li>
</ul>
<h2>Automation</h2>
<ul>
<li>Want to make common commands re-runnable<ul>
<li>More trustworthy than documentation</li>
</ul>
</li>
<li>Used to use <a href="https://www.gnu.org/software/make/">Make</a> to do this, but it's showing its age<ul>
<li>And its syntax is unpleasant</li>
</ul>
</li>
<li>Use <a href="https://www.pyinvoke.org/">Invoke</a> instead</li>
<li><code>pip install invoke</code> and then add <code>invoke&gt;=1.7</code> to `requirements.txt</li>
<li>Create a file in the project's root directory called <code>tasks.py</code>:</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="sd">&quot;&quot;&quot;Run common tasks.&quot;&quot;&quot;</span>

<span class="kn">from</span> <span class="nn">invoke</span> <span class="kn">import</span> <span class="n">task</span>


<span class="nd">@task</span>
<span class="k">def</span> <span class="nf">list</span><span class="p">(</span><span class="n">c</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;List available tasks.&quot;&quot;&quot;</span>
    <span class="n">c</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="s2">&quot;inv --list&quot;</span><span class="p">)</span>


<span class="nd">@task</span>
<span class="k">def</span> <span class="nf">test</span><span class="p">(</span><span class="n">c</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Run tests.&quot;&quot;&quot;</span>
    <span class="n">c</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="s2">&quot;pytest&quot;</span><span class="p">)</span>
</code></pre></div>
<ul>
<li>The <code>@task</code> decorator identifies functions that can be run as tasks<ul>
<li>They can do any other processing (but we don't need them to yet)</li>
</ul>
</li>
<li>The <code>c</code> parameter is a context that has details about the run<ul>
<li>We don't need that yet either</li>
</ul>
</li>
<li>Run <code>inv list</code>:</li>
</ul>
<div class="highlight"><pre><span></span><code>Available tasks:

  list   List available tasks
  test   Run tests
</code></pre></div>
<ul>
<li>We need to set up a <a class="glossref" href="../gloss/#linter" markdown="1">linter</a> to check code quality</li>
<li>And <a class="glossref" href="../gloss/#ci" markdown="1">continuous integration</a> to make sure it runs</li>
<li>But we need some useful code first</li>
</ul>
<h2>Linting</h2>
<ul>
<li><a href="https://www.python.org/dev/peps/pep-0008/">PEP 8</a> lays out some guidelines for readable Python, but checking those rules is tedious</li>
<li><a href="https://pypi.org/project/black/">Black</a>, <a href="https://flake8.pycqa.org/">Flake8</a>, and <a href="https://pycqa.github.io/isort/">isort</a> check most of the rules for you<ul>
<li>And can reformat code to obey them</li>
</ul>
</li>
<li><code>pip install black flake8 isort</code> and then add entries to <code>requirements.txt</code></li>
<li><code>black --check .</code> will check all the Python code in or below the current directory</li>
<li><code>black .</code> will reformat anything that doesn't conform to style guidelines</li>
<li><code>flake8</code> only checks for flaky code</li>
<li><code>isort</code> can both check and reformat (order and format of <code>import</code> statements)</li>
<li>So add two tasks to <code>tasks.py</code>:<ul>
<li>The term "lint" comes from an early tool for C that reported questionable code</li>
</ul>
</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="nd">@task</span>
<span class="k">def</span> <span class="nf">lint</span><span class="p">(</span><span class="n">c</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Run checks on code.&quot;&quot;&quot;</span>
    <span class="n">c</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="s2">&quot;flake8&quot;</span><span class="p">,</span> <span class="n">warn</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">c</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="s2">&quot;isort --check .&quot;</span><span class="p">)</span>
    <span class="n">c</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="s2">&quot;black --check .&quot;</span><span class="p">)</span>


<span class="nd">@task</span>
<span class="k">def</span> <span class="nf">reformat</span><span class="p">(</span><span class="n">c</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Reformat code.&quot;&quot;&quot;</span>
    <span class="n">c</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="s2">&quot;isort .&quot;</span><span class="p">)</span>
    <span class="n">c</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="s2">&quot;black .&quot;</span><span class="p">)</span>
</code></pre></div>
<ul>
<li>Change the test to actually test something</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">test_module_can_be_imported</span><span class="p">():</span>
    <span class="k">assert</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">mesachie</span><span class="p">,</span> <span class="s2">&quot;__author__&quot;</span><span class="p">)</span>
    <span class="k">assert</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">mesachie</span><span class="p">,</span> <span class="s2">&quot;__version__&quot;</span><span class="p">)</span>
</code></pre></div>
<h2>Continuous Integration</h2>
<ul>
<li>Should always run checks when committing code<ul>
<li>Or changing documentation, or...</li>
</ul>
</li>
<li>But human beings are fallible, so automate: continuous integration (CI)</li>
<li>Many dedicated CI services like <a href="https://circleci.com/">Circle CI</a></li>
<li>For a project this size, easiest is <a href="https://docs.github.com/en/actions">GitHub Actions</a></li>
<li>Create a directory <code>.github/workflows</code> beneath the root of the project</li>
<li>Add a file <code>test-on-push.yml</code> in that directory:</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Test on Push</span><span class="w"></span>
<span class="nt">on</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="nt">push</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">branches</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">main</span><span class="w"></span>
<span class="w">  </span><span class="nt">pull_request</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">branches</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">main</span><span class="w"></span>
<span class="nt">jobs</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="nt">build</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">runs-on</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ubuntu-latest</span><span class="w"></span>
<span class="w">    </span><span class="nt">steps</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">actions/checkout@v2</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Set up Python</span><span class="w"></span>
<span class="w">        </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">actions/setup-python@v1</span><span class="w"></span>
<span class="w">        </span><span class="nt">with</span><span class="p">:</span><span class="w"></span>
<span class="w">          </span><span class="nt">python-version</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">3.9</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Install dependencies</span><span class="w"></span>
<span class="w">        </span><span class="nt">run</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|</span><span class="w"></span>
<span class="w">          </span><span class="no">python -m pip install --upgrade pip</span><span class="w"></span>
<span class="w">          </span><span class="no">pip install -r requirements.txt</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Run code checks</span><span class="w"></span>
<span class="w">        </span><span class="nt">run</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">inv lint</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Run tests</span><span class="w"></span>
<span class="w">        </span><span class="nt">run</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">inv test</span><span class="w"></span>
<span class="w">        </span><span class="nt">if</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${{ always() }}</span><span class="w"></span>
</code></pre></div>
<ul>
<li><code>name</code> is the name of the action (used in error reporting, etc.)</li>
<li><code>on</code> defines when the action runs<ul>
<li>When there's a <code>push</code> to the <code>main</code> branch</li>
<li>When anyone creates a pull request whose target is <code>main</code></li>
<li>Lots of other options</li>
</ul>
</li>
<li><code>jobs</code> defines what to do when the action runs<ul>
<li>An action can run many jobs in parallel</li>
</ul>
</li>
<li>We want to build our software on the latest version of Ubuntu Linux<ul>
<li>Probably the most common platform</li>
</ul>
</li>
<li>Spell out the steps:<ul>
<li>Use a <a href="https://github.com/actions">pre-defined <code>checkout</code> action</a> to get a fresh copy of the repo</li>
<li>Set up Python using another pre-defined action</li>
<li>Install everything listed in <code>requirements.txt</code></li>
<li>Run the code checks (do <em>not</em> reformat, just check)</li>
<li>Run the tests: the <code>if</code> condition means "even if the previous linting step fails"</li>
</ul>
</li>
<li>Before we test it, let's split requirements into "needed for install" and "also used in dev"</li>
<li><code>requirements.txt</code> becomes:</li>
</ul>
<div class="highlight"><pre><span></span><code>kaleido&gt;=0.2
pandas&gt;=1.4
plotly&gt;=5.6
pydantic&gt;=1.9.0
pyyaml&gt;=5.4
requests&gt;=2.27
statsmodels&gt;=0.13
</code></pre></div>
<ul>
<li>Create a new file <code>development.txt</code> that tells <code>pip</code> to read <code>requirements.txt</code> (using <code>-r</code>) then add more packages</li>
</ul>
<div class="highlight"><pre><span></span><code>-r requirements.txt
black&gt;=22.1
coverage&gt;=6.3
flake8&gt;=4.0
invoke&gt;=1.7
isort&gt;=5.10
ivy&gt;=6.2
pdoc3&gt;=0.10
pymdown-extensions&gt;=9.3
pyproject-flake8
pytest&gt;=7.1
</code></pre></div>
<ul>
<li><code>git add</code> changes, commit, push to GitHub, go to the <code>Actions</code> tab: the job has failed<ul>
<li>Because <code>invoke</code> isn't included in <code>requirements.txt</code>, but is needed for the action</li>
<li>So are <code>black</code>, <code>flake8</code>, <code>isort</code>, and <code>pytest</code></li>
</ul>
</li>
<li>Move <code>invoke</code> to <code>requirements.txt</code>, add, commit, push<ul>
<li>Works this time</li>
<li>Some projects have <code>development.txt</code>, <code>testing.txt</code>, and <code>requirements.txt</code> for this reason</li>
<li>It all should live in <code>pyproject.toml</code>...</li>
</ul>
</li>
</ul>
<div class="callout">
<h3>Other Jobs</h3>
<p>The GitHub Actions tab shows all the jobs, including the ones that build and deploy the website.
If you have pushed several times, then rebase and push the combined commit,
the jobs run by the now-squashed commits still show up.</p>
</div>
      </div>
    </div>
  </body>
</html>
